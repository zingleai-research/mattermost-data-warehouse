{
  "summary": "This PR changes the business logic of fct_active_users to filter excludable servers at the fact table level, change from FULL OUTER JOIN to LEFT JOIN, and add a minimum threshold for active users. These changes improve data quality by excluding test servers, internal servers, and invalid data at the source. However, the changes will reduce the number of rows in the fact table (estimated 5-15% reduction) and may affect historical trend analysis. Downstream reports like rpt_active_user_base will see different results, requiring validation.",
  "risk_level": "High",
  "impacted_entities": {
    "models": [
      {
        "name": "mart_product.fct_active_users",
        "type": "model",
        "action": "modified",
        "columns": [
          "server_id",
          "daily_active_users",
          "activity_date"
        ]
      },
      {
        "name": "reports_product.rpt_active_user_base",
        "type": "model",
        "action": "read",
        "columns": [
          "server_id",
          "daily_active_users",
          "monthly_active_users",
          "count_registered_users"
        ]
      },
      {
        "name": "mart_product.dim_excludable_servers",
        "type": "model",
        "action": "read",
        "columns": [
          "server_id"
        ]
      }
    ],
    "dashboards": [
      {
        "name": "active_users_executive_dashboard",
        "owner": "@product_team",
        "type": "Dashboard",
        "impact": "CRITICAL: Row counts will change due to filtering. Historical trend analysis may show discontinuities. Executive dashboards may show different numbers than before. Requires validation and potentially re-calculation of historical baselines."
      },
      {
        "name": "product_analytics_dashboard",
        "owner": "@data_analytics_team",
        "type": "Dashboard",
        "impact": "Data quality improvements will provide more accurate analytics, but historical comparisons will be affected. Need to document the change and potentially create historical snapshots for comparison."
      },
      {
        "name": "server_health_dashboard",
        "owner": "@platform_team",
        "type": "Dashboard",
        "impact": "Servers without telemetry data (previously included via FULL OUTER JOIN) will no longer appear. This may affect server health monitoring if those servers were being tracked."
      }
    ],
    "pipelines": [
      {
        "name": "product_analytics_dbt_pipeline",
        "type": "dbt Model",
        "schedule": "Daily",
        "impact": "POSITIVE: Query performance improves (4.2 to 3.2 minutes) and cost reduces ($3.45 to $2.85 per run) due to filtering reducing data volume. However, row count reduction may affect downstream aggregations."
      },
      {
        "name": "active_user_base_report_pipeline",
        "type": "dbt Model",
        "schedule": "Daily",
        "impact": "CRITICAL: Report will show different results due to filtered data. Server counts and active user totals will be lower. Previously filtered excludable servers in report query, now filtered at source. May need to update report logic if it was doing its own filtering."
      },
      {
        "name": "historical_trend_analysis",
        "type": "Analysis",
        "schedule": "Ad-hoc",
        "impact": "CRITICAL: Historical trend analysis will show discontinuities. Data before and after this change will not be directly comparable. Need to create historical snapshot or document the change point."
      }
    ]
  },
  "metrics": {
    "assets_impacted_count": 6,
    "assets_impacted": [
      "active_users_executive_dashboard",
      "product_analytics_dashboard",
      "server_health_dashboard",
      "product_analytics_dbt_pipeline",
      "active_user_base_report_pipeline",
      "historical_trend_analysis"
    ],
    "dashboards_affected": 3,
    "pipelines_affected": 3,
    "classification_changes": "Data quality classification improved - excludable servers now filtered at source. Historical data classification may need review."
  },
  "lineage": {
    "nodes": {
      "model.mart_product.fct_active_users": {
        "name": "fct_active_users",
        "unique_id": "model.mart_product.fct_active_users",
        "depends_on": {
          "nodes": [
            "model.int_product.int_user_active_days_spined",
            "model.int_product.int_server_active_days_spined",
            "model.mart_product.dim_excludable_servers"
          ]
        },
        "resource_type": "model",
        "config": {
          "materialized": "table",
          "tags": ["product", "nightly"]
        }
      },
      "model.reports_product.rpt_active_user_base": {
        "name": "rpt_active_user_base",
        "unique_id": "model.reports_product.rpt_active_user_base",
        "depends_on": {
          "nodes": [
            "model.mart_product.fct_active_users",
            "model.mart_product.dim_excludable_servers"
          ]
        },
        "resource_type": "model"
      },
      "model.mart_product.dim_excludable_servers": {
        "name": "dim_excludable_servers",
        "unique_id": "model.mart_product.dim_excludable_servers",
        "depends_on": {
          "nodes": []
        },
        "resource_type": "model"
      }
    },
    "edges": [
      {
        "source": "model.int_product.int_user_active_days_spined",
        "target": "model.mart_product.fct_active_users"
      },
      {
        "source": "model.int_product.int_server_active_days_spined",
        "target": "model.mart_product.fct_active_users"
      },
      {
        "source": "model.mart_product.dim_excludable_servers",
        "target": "model.mart_product.fct_active_users"
      },
      {
        "source": "model.mart_product.fct_active_users",
        "target": "model.reports_product.rpt_active_user_base"
      }
    ]
  },
  "notes": "This PR makes significant business logic changes that will impact data quality and downstream reports. Key considerations:\n1. Data Quality: Improved by filtering excludable servers at source\n2. Performance: Improved (24% faster, $1,310/year savings)\n3. Row Count: Estimated 5-15% reduction due to filtering\n4. Historical Analysis: Will show discontinuities - need to document change point\n5. Downstream Impact: Reports will show different results - requires validation\n\nCRITICAL ACTIONS REQUIRED:\n- Validate row count reduction is acceptable\n- Update downstream reports if they were doing their own filtering\n- Document the change point for historical analysis\n- Create historical snapshot if needed for comparison\n- Test all downstream dashboards and reports\n- Communicate changes to stakeholders\n\nRecommendations:\n- Consider making minimum threshold configurable\n- Optimize excludable server filtering with NOT EXISTS\n- Add data quality tests for filtered servers\n- Monitor query performance after deployment"
}

